<form #addUserForm="ngForm" (ngSubmit)="saveUser(addUserForm)">
  @if (loading) {
  <mat-progress-bar [mode]="'indeterminate'"> </mat-progress-bar>
  }
  <h2 mat-dialog-title>Add new user</h2>
  <mat-dialog-content>
    <div style="display: flex; gap: 16px">
      <mat-form-field appearance="outline" style="width: 100%">
        <mat-label>First name</mat-label>
        <input
          matInput
          name="firstName"
          [(ngModel)]="user.firstName"
          #firstName="ngModel"
          [disabled]="loading"
          required
          minlength="2"
          maxlength="15"
          pattern="^[A-Za-zÄäÖöÜüß\- ]+$"
        />
        <mat-error
          *ngIf="firstName.invalid && (firstName.dirty || firstName.touched)"
        >
          <span *ngIf="firstName.errors?.['required']"
            >First name is required.</span
          >
          <span *ngIf="firstName.errors?.['minlength']"
            >Min. 2 letters required.</span
          >
          <span *ngIf="firstName.errors?.['maxlength']"
            >Max. 15 letters allowed.</span
          >
          <span *ngIf="firstName.errors?.['pattern']"
            >Only letters and - allowed.</span
          >
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 100%">
        <mat-label>Last name</mat-label>
        <input
          matInput
          name="lastName"
          [(ngModel)]="user.lastName"
          #lastName="ngModel"
          [disabled]="loading"
          required
          minlength="2"
          maxlength="15"
          pattern="^[A-Za-zÄäÖöÜüß\- ]+$"
        />
        <mat-error
          *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)"
        >
          <span *ngIf="lastName.errors?.['required']"
            >Last name is required.</span
          >
          <span *ngIf="lastName.errors?.['minlength']"
            >Min. 2 letters required.</span
          >
          <span *ngIf="lastName.errors?.['maxlength']"
            >Max. 15 letters allowed.</span
          >
          <span *ngIf="lastName.errors?.['pattern']"
            >Only letters and - allowed.</span
          >
        </mat-error>
      </mat-form-field>
    </div>
    <div style="display: flex; gap: 16px">
      <mat-form-field appearance="outline" style="width: 65%">
        <mat-label>E-mail</mat-label>
        <input
          matInput
          name="email"
          [(ngModel)]="user.email"
          #email="ngModel"
          [disabled]="loading"
          required
          email
        />
        <mat-error *ngIf="email.invalid && (email.dirty || email.touched)">
          <span *ngIf="email.errors?.['required']">E-mail is required.</span>
          <span *ngIf="email.errors?.['email']">Invalid e-mail format.</span>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 35%">
        <mat-label>Birth date</mat-label>
        <input
          matInput
          name="birthDate"
          [disabled]="loading"
          [matDatepicker]="picker"
          [(ngModel)]="birthDate"
          #birthDateModel="ngModel"
          required
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error
          *ngIf="
            birthDateModel.invalid &&
            (birthDateModel.dirty || birthDateModel.touched)
          "
        >
          <span *ngIf="birthDateModel.errors?.['required']"
            >Birthdate is required.</span
          >
        </mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline" style="width: 100%">
        <mat-label>Street & Nr.</mat-label>
        <input
          matInput
          name="street"
          [(ngModel)]="user.street"
          #street="ngModel"
          required
          [disabled]="loading"
        />
        <mat-error *ngIf="street.invalid && (street.dirty || street.touched)">
          <span *ngIf="street.errors?.['required']">Street is required.</span>
        </mat-error>
      </mat-form-field>
    </div>
    <div style="display: flex; gap: 16px">
      <mat-form-field appearance="outline" style="width: 35%">
        <mat-label>Zip Code</mat-label>
        <input
          matInput
          name="zipCode"
          [(ngModel)]="user.zipCode"
          #zipCode="ngModel"
          required
          pattern="^[0-9]{1,5}$"
          maxlength="5"
          [disabled]="loading"
        />
        <mat-error
          *ngIf="zipCode.invalid && (zipCode.dirty || zipCode.touched)"
        >
          <span *ngIf="zipCode.errors?.['required']"
            >Zip code is required.</span
          >
          <span *ngIf="zipCode.errors?.['pattern']"
            >Only numbers (max 5 digits).</span
          >
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 65%">
        <mat-label>City</mat-label>
        <input
          matInput
          name="city"
          [(ngModel)]="user.city"
          #city="ngModel"
          required
          pattern="^[A-Za-zÄäÖöÜüß\- ]+$"
          [disabled]="loading"
        />
        <mat-error *ngIf="city.invalid && (city.dirty || city.touched)">
          <span *ngIf="city.errors?.['required']">City is required.</span>
          <span *ngIf="city.errors?.['pattern']">Only letters allowed.</span>
        </mat-error>
      </mat-form-field>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button [disabled]="loading" type="button" (click)="onNoClick()">
      Cancel
    </button>
    <button mat-button [disabled]="loading" type="submit">Save</button>
  </mat-dialog-actions>
</form>
